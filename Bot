from flask import Flask, request, send_file, jsonify
from gtts import gTTS
import os
from io import BytesIO

app = Flask(__name__)

@app.route('/convert', methods=['POST'])
def convert_text():
    data = request.get_json()
    text = data.get("text", "")
    lang = data.get("lang", "en")

    if not text:
        return jsonify({"error": "No text provided"}), 400

    tts = gTTS(text, lang=lang)
    mp3_fp = BytesIO()
    tts.write_to_fp(mp3_fp)
    mp3_fp.seek(0)

    return send_file(mp3_fp, mimetype='audio/mpeg', as_attachment=True, download_name="speech.mp3")

if __name__ == '__main__':
    app.run(debug=True)
